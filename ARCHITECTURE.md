# üèó –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AI-Tourist 2.0

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è](#–æ–±—â–∞—è-–∫–æ–Ω—Ü–µ–ø—Ü–∏—è)
2. [–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã: —á—Ç–æ –∏ –∑–∞—á–µ–º](#–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã-—á—Ç–æ-–∏-–∑–∞—á–µ–º)
3. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ-—Ä–µ—à–µ–Ω–∏—è-–∏-–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è)
4. [DevOps –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#devops-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
5. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
6. [–ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏](#–∞–ª–≥–æ—Ä–∏—Ç–º—ã-–∏-—ç–≤—Ä–∏—Å—Ç–∏–∫–∏)
7. [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å](#–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ-–∏-–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å)

---

## üéØ –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

**AI-Tourist 2.0** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–µ—à–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ –ù–∏–∂–Ω–µ–º—É –ù–æ–≤–≥–æ—Ä–æ–¥—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞.

### –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ–º

–¢—É—Ä–∏—Å—Ç—ã –∏ –∂–∏—Ç–µ–ª–∏ –≥–æ—Ä–æ–¥–∞ —Ö–æ—Ç—è—Ç —Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥—É–ª–∫–∏ —Å —É—á–µ—Ç–æ–º:
- **–õ–∏—á–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤** (–∫—É–ª—å—Ç—É—Ä–∞, –∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–∏—Ä–æ–¥–∞, –≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è)
- **–°–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** (–æ–¥–∏–Ω, —Å –¥—Ä—É–∑—å—è–º–∏, —Å —Å–µ–º—å–µ–π, –ø–∞—Ä–∞)
- **–¢–µ–º–ø–∞ –ø—Ä–æ–≥—É–ª–∫–∏** (—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è, —É–º–µ—Ä–µ–Ω–Ω–∞—è, –∞–∫—Ç–∏–≤–Ω–∞—è)
- **–í—Ä–µ–º–µ–Ω–∏ –∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∏** (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç, –≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ—Å—Ç, –∫–æ—Ñ–µ-–±—Ä–µ–π–∫–∏)

–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (Google Maps, TripAdvisor) –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –±–ª–∏–∑–æ—Å—Ç—å** –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –º–µ—Å—Ç–∞–º –∏ –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç –º–∞—Ä—à—Ä—É—Ç –ø–æ —Å–ª–æ–∂–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ú—ã –≤—ã–±—Ä–∞–ª–∏ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:

#### ‚úÖ –ü–æ—á–µ–º—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã?

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
   - –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Ä–µ—à–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É (Single Responsibility Principle)
   - Embedding service —Ç–æ–ª—å–∫–æ –≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ—Ç, Ranking —Ç–æ–ª—å–∫–æ —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç
   - –ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

2. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Embedding service —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ CPU/RAM ‚Üí –º–æ–∂–µ–º –¥–∞—Ç—å –µ–º—É 1 Gi –ø–∞–º—è—Ç–∏
   - LLM service –¥–µ–ª–∞–µ—Ç –º–∞–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ 1 —Ä–µ–ø–ª–∏–∫–∏
   - API Gateway –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ ‚Üí 2 —Ä–µ–ø–ª–∏–∫–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

3. **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥–∏–±–∫–æ—Å—Ç—å**
   - –ú–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
   - Embedding service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç sentence-transformers
   - Route Planner –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NetworkX –¥–ª—è –≥—Ä–∞—Ñ–æ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
   - LLM service —Ä–∞–±–æ—Ç–∞–µ—Ç —Å OpenAI/Anthropic API

4. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**
   - –ï—Å–ª–∏ LLM service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –Ω–∞ —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
   - –ï—Å–ª–∏ Geocoding —Å–ª–æ–º–∞–ª—Å—è ‚Üí –º–∞—Ä—à—Ä—É—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
   - API Gateway –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL

5. **Production-ready —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è**
   - Kubernetes –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
   - Health checks –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   - Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - gRPC –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

---

## üîß –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã: —á—Ç–æ –∏ –∑–∞—á–µ–º

### 1. Frontend (React + TypeScript)

**–ü—É—Ç—å:** `frontend/`
**–ü–æ—Ä—Ç:** 5173 (dev), 80 (prod)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** React 18, TypeScript, Vite, Tailwind CSS, React Leaflet

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- SPA (Single Page Application) —Å —Ñ–æ—Ä–º–æ–π –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –º–∞—Ä—à—Ä—É—Ç–∞ (Leaflet)
- –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (Framer Motion)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –¥–µ—Å–∫—Ç–æ–ø–æ–≤

#### –ü–æ—á–µ–º—É —ç—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏?

**React 18:**
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Å –æ–≥—Ä–æ–º–Ω–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Üí –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
- Hooks –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±–µ–∑ –∫–ª–∞—Å—Å–æ–≤
- Server Components –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ SSR

**TypeScript:**
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è ‚Üí –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤ –Ω–∞ –ø—Ä–æ–¥–µ
- –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE ‚Üí –±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ (IDE –≤–∏–¥–∏—Ç –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–∞)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç–∏–ø—ã (–Ω–µ –Ω—É–∂–Ω–æ –≥–∞–¥–∞—Ç—å, —á—Ç–æ –≤ –æ–±—ä–µ–∫—Ç–µ)

**Vite:**
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞** (cold start <1s vs 10-30s —É Webpack)
- Hot Module Replacement (HMR) ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
- ES Modules –Ω–∞—Ç–∏–≤–Ω–æ ‚Üí –Ω–µ –Ω—É–∂–µ–Ω –±–∞–Ω–¥–ª–∏–Ω–≥ –≤ dev-—Ä–µ–∂–∏–º–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π build (Rollup) ‚Üí –º–µ–Ω—å—à–∏–π bundle size

**Tailwind CSS:**
- Utility-first –ø–æ–¥—Ö–æ–¥ ‚Üí –Ω–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–µ–º –∏–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤
- –ù–µ—Ç CSS —Ñ–∞–π–ª–æ–≤ ‚Üí –≤—Å—ë –≤ JSX, –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
- PurgeCSS –≤—Å—Ç—Ä–æ–µ–Ω ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π bundle —Ç–æ–ª—å–∫–æ —Å –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏–∑ –∫–æ—Ä–æ–±–∫–∏ (spacing, colors, breakpoints)

**React Leaflet:**
- –õ—É—á—à–∞—è open-source –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∫–∞—Ä—Ç (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Google Maps)
- –õ–µ–≥–∫–∞—è (40 KB vs 500+ KB —É Google Maps SDK)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è (–º–æ–∂–µ–º –º–µ–Ω—è—Ç—å —Ç–∞–π–ª—ã, —Å—Ç–∏–ª–∏, –º–∞—Ä–∫–µ—Ä—ã)
- React-friendly API (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```typescript
// –§–æ—Ä–º–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
interests: string[]          // ["–∏—Å—Ç–æ—Ä–∏—è", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"]
socialMode: "solo" | "friends" | "couple" | "family"
intensity: "relaxed" | "medium" | "intense"
duration: number             // –≤ –º–∏–Ω—É—Ç–∞—Ö
coffeeBreak: boolean
startLocation: {lat, lon}

// –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç API
route: {
  pois: POI[]               // —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
  totalDistance: number     // –≤ –º–µ—Ç—Ä–∞—Ö
  totalDuration: number     // –≤ –º–∏–Ω—É—Ç–∞—Ö
  explanation: string       // –æ—Ç LLM
  geometry: LineString      // –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
}
```

---

### 2. API Gateway (FastAPI)

**–ü—É—Ç—å:** `services/api-gateway/`
**–ü–æ—Ä—Ç—ã:** 8000 (HTTP), 9090 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** FastAPI, Uvicorn, gRPC clients

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- REST API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`/api/v1/*`)
- –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –æ—Ç gRPC-—Å–µ—Ä–≤–∏—Å–æ–≤
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (orchestration)
- Health checks –∏ –º–µ—Ç—Ä–∏–∫–∏

#### –ü–æ—á–µ–º—É FastAPI?

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - Async/await –∏–∑ –∫–æ—Ä–æ–±–∫–∏ ‚Üí –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π I/O
   - –ë—ã—Å—Ç—Ä–µ–µ Flask/Django –Ω–∞ 2-3x (–±–µ–Ω—á–º–∞—Ä–∫–∏ TechEmpower)
   - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è high-load (10K+ RPS –Ω–∞ —Å—Ä–µ–¥–Ω–µ–π –º–∞—à–∏–Ω–µ)

2. **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**
   - OpenAPI (Swagger) –∏–∑ –∫–æ—Ä–æ–±–∫–∏ ‚Üí `/docs`
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∏–¥—è—Ç API –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
   - Pydantic –º–æ–¥–µ–ª–∏ ‚Üí —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
   - Pydantic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JSON
   - –ü–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
   - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: SQL injection, XSS –∑–∞—â–∏—Ç–∞ –∏–∑ –∫–æ—Ä–æ–±–∫–∏

4. **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Python**
   - Type hints ‚Üí —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (mypy)
   - Dependency Injection ‚Üí –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
   - Middleware –¥–ª—è CORS, logging, tracing

#### –ü—Ä–∏–º–µ—Ä flow –∑–∞–ø—Ä–æ—Å–∞

```python
# POST /api/v1/routes/plan
@router.post("/routes/plan")
async def plan_route(request: RoutePlanRequest):
    # 1. –í–µ–∫—Ç–æ—Ä–∏–∑—É–µ–º –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    embedding = await embedding_client.generate(request.interests)

    # 2. –ü–æ–ª—É—á–∞–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç—ã POI
    pois = await poi_client.get_all()

    # 3. –†–∞–Ω–∂–∏—Ä—É–µ–º –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
    ranked = await ranking_client.rank(
        pois, embedding, request.social_mode, request.intensity
    )

    # 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –º–∞—Ä—à—Ä—É—Ç
    route = await route_planner_client.optimize(
        ranked, request.duration, request.start_location
    )

    # 5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ LLM
    explanation = await llm_client.explain(route)

    return RouteResponse(route=route, explanation=explanation)
```

#### Health Checks

```python
# /healthz - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–≤–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
# /readyz - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤
@app.get("/readyz")
async def readiness_check():
    services_status = await grpc_clients.health_check()
    dependencies_ready = all(services_status.values())

    return {
        "ready": dependencies_ready,
        "dependencies": {
            "embedding": services_status["embedding"],
            "ranking": services_status["ranking"],
            # ...
        }
    }
```

**–ó–∞—á–µ–º –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö endpoint?**
- `liveness` ‚Üí Kubernetes –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç pod, –µ—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- `readiness` ‚Üí Kubernetes –Ω–µ —à–ª–µ—Ç —Ç—Ä–∞—Ñ–∏–∫, –ø–æ–∫–∞ –Ω–µ –≥–æ—Ç–æ–≤

---

### 3. Embedding Service (Python + Sentence Transformers)

**–ü—É—Ç—å:** `services/embedding-service/`
**–ü–æ—Ä—Ç:** 50051 (gRPC), 9091 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** sentence-transformers, Redis cache

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –≤–µ–∫—Ç–æ—Ä—ã (embeddings) —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ 384
- –ö–µ—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Redis
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞—Ç—á–∏–Ω–≥ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

#### –ü–æ—á–µ–º—É Sentence Transformers?

**–ú–æ–¥–µ–ª—å:** `paraphrase-multilingual-MiniLM-L12-v2`

1. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å**
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, 50+ —è–∑—ã–∫–æ–≤
   - –¢—É—Ä–∏—Å—Ç—ã –º–æ–≥—É—Ç –≤–≤–æ–¥–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ
   - POI –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –Ω–æ —Å–µ–º–∞–Ω—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

2. **–ö–∞—á–µ—Å—Ç–≤–æ embeddings**
   - –û–±—É—á–µ–Ω–∞ –Ω–∞ –ø–∞—Ä–µ "–≤–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç" ‚Üí –ø–æ–Ω–∏–º–∞–µ—Ç intent
   - Cosine similarity —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
   - State-of-the-art –Ω–∞ –±–µ–Ω—á–º–∞—Ä–∫–∞—Ö (STSB, SICK-R)

3. **–ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å**
   - 12 —Å–ª–æ–µ–≤ (vs 24 —É BERT-large)
   - 118M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ‚Üí —É–º–µ—â–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç—å
   - –ò–Ω—Ñ–µ—Ä–µ–Ω—Å ~50ms –Ω–∞ CPU, ~5ms –Ω–∞ GPU

4. **MiniLM vs BERT**
   - –î–∏—Å—Ç–∏–ª–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (teacher: BERT, student: MiniLM)
   - 2x –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–∏–º–æ–º –∫–∞—á–µ—Å—Ç–≤–µ
   - –ú–µ–Ω—å—à–µ RAM ‚Üí –º–æ–∂–µ–º –¥–µ—Ä–∂–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –≤—ã–±—Ä–∞–ª–∏:**
- ‚ùå OpenAI Embeddings API ‚Üí –¥–æ—Ä–æ–≥–æ ($0.0001/1K —Ç–æ–∫–µ–Ω–æ–≤), –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç API
- ‚ùå BERT-base ‚Üí —Ç—è–∂–µ–ª–µ–µ, –Ω–µ –∑–∞—Ç–æ—á–µ–Ω –ø–æ–¥ similarity search
- ‚ùå Word2Vec ‚Üí —É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç ("–±–∞–Ω–∫" —É —Ä–µ–∫–∏ vs —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π)

#### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis

```python
# –ó–∞—á–µ–º –∫–µ—à?
# 1. POI embeddings —Å—á–∏—Ç–∞–µ–º —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ‚Üí –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º
# 2. –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ("–∏—Å—Ç–æ—Ä–∏—è", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞") ‚Üí —Ö–∏—Ç –∫–µ—à–∞

cache_key = f"embedding:{text_hash}"
if cached := await redis.get(cache_key):
    return json.loads(cached)

embedding = model.encode(text)
await redis.setex(cache_key, ttl=3600, json.dumps(embedding))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Å–Ω–∏–∂–µ–Ω–∏–µ latency —Å 50ms –¥–æ 2ms –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

### 4. Ranking Service (Python + NumPy)

**–ü—É—Ç—å:** `services/ranking-service/`
**–ü–æ—Ä—Ç:** 50052 (gRPC), 9092 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** NumPy, SQLAlchemy, PostgreSQL

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- –†–∞–Ω–∂–∏—Ä—É–µ—Ç POI –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å—É
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É (cosine similarity)
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ (social mode, intensity, –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã)

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è

**ADR-0002** –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –Ω–∞—à –ø–æ–¥—Ö–æ–¥:

```python
final_score = (
    0.55 * semantic_score      # cosine similarity
    + 0.20 * quality_score     # —Ä–µ–π—Ç–∏–Ω–≥ POI
    + 0.15 * popularity_score  # –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    + 0.10 * context_score     # social + intensity
) * schedule_factor            # –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
```

**–ü–æ—á–µ–º—É —Ç–∞–∫–∏–µ –≤–µ—Å–∞?**

1. **55% semantic_score**
   - –ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç "–≥–æ—Ç–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞" ‚Üí –°–æ–±–æ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ –ø–∞—Ä–∫–∞
   - Cosine similarity –Ω–∞–ø—Ä—è–º—É—é –∏–∑–º–µ—Ä—è–µ—Ç —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

2. **20% quality_score**
   - –†–µ–π—Ç–∏–Ω–≥ 4.8 vs 3.2 –≤–∞–∂–µ–Ω, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω
   - –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —á–µ—Ä–µ–∑ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é ‚Üí –∏–∑–±–µ–≥–∞–µ–º –≤—ã–±—Ä–æ—Å–æ–≤
   - Z-score (rating - mean) / std ‚Üí —É—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

3. **15% popularity_score**
   - –ß–∞—Å—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–º—É–∑–µ–∏) vs —Ä–µ–¥–∫–∏–µ (–æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–∏–∏)
   - –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ–º: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ, –Ω–æ –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–∏—à–µ–≤–æ–µ

4. **10% context_score**
   - –õ–µ–≥–∫–∏–π –±—É—Å—Ç –¥–ª—è social mode (friends ‚Üí –±–∞—Ä—ã, family ‚Üí –ø–∞—Ä–∫–∏)
   - Intensity (active ‚Üí –±–æ–ª—å—à–µ —Ç–æ—á–µ–∫, relaxed ‚Üí –º–µ–Ω—å—à–µ)
   - –ù–µ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç, —á—Ç–æ–±—ã –Ω–µ —É–±–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏–∫—É

5. **schedule_factor (–º–Ω–æ–∂–∏—Ç–µ–ª—å)**
   - 1.05 –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ ‚Üí –ª–µ–≥–∫–∏–π –±—É—Å—Ç
   - 0.55 –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–æ ‚Üí —Å–∏–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ
   - –ì—Ä–∞–¥–∏–µ–Ω—Ç: —Å–∫–æ—Ä–æ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è (0.92), –¥–∞–≤–Ω–æ –∑–∞–∫—Ä—ã–ª–æ—Å—å (0.55)

#### –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏

```python
SOCIAL_COMPATIBILITY = {
    "solo": ("friends",),           # –æ–¥–∏–Ω–æ—á–∫–∞ –º–æ–∂–µ—Ç —Å –¥—Ä—É–∑—å—è–º–∏
    "friends": ("solo", "couple"),  # –¥—Ä—É–∑—å—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –ø–∞—Ä–æ–π
    "couple": ("friends", "family"),
    "family": ("friends",),
    "any": ("solo", "friends", "couple", "family"),
}

# –ü—Ä–∏–º–µ—Ä: POI –¥–ª—è friends, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å couple
if request_mode in SOCIAL_COMPATIBILITY[poi_mode]:
    return 0.88  # –≤—ã—Å–æ–∫–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
else:
    return 0.65  # –Ω–∏–∑–∫–∞—è
```

**–ó–∞—á–µ–º —ç—Ç–æ?**
- –ë–∞—Ä —Å —à—É–º–Ω–æ–π –º—É–∑—ã–∫–æ–π ‚Üí —Ö–æ—Ä–æ—à –¥–ª—è friends, –ø–ª–æ—Ö –¥–ª—è family
- –î–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞ ‚Üí –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è family, —Å–∫—É—á–Ω–æ –¥–ª—è couple
- –°–º–æ—Ç—Ä–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞ ‚Üí universal (any)

#### Intensity Alignment

```python
INTENSITY_ALIGNMENT = {
    "relaxed": {"relaxed": 1.0, "medium": 0.85, "intense": 0.6},
    "medium": {"relaxed": 0.9, "medium": 1.0, "intense": 0.85},
    "intense": {"relaxed": 0.65, "medium": 0.9, "intense": 1.0},
}
```

**–õ–æ–≥–∏–∫–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª "—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞"
- POI —Å `intensity=intense` (–ø–æ–¥—ä–µ–º –Ω–∞ —Ö–æ–ª–º) ‚Üí —à—Ç—Ä–∞—Ñ 0.6x
- POI —Å `intensity=relaxed` (–∫–∞—Ñ–µ, —Å–∫–≤–µ—Ä) ‚Üí –±—É—Å—Ç 1.0x

---

### 5. Route Planner Service (Python + NetworkX)

**–ü—É—Ç—å:** `services/route-planner-service/`
**–ü–æ—Ä—Ç:** 50053 (gRPC), 9093 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** NetworkX, Redis, 2GIS API

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –ø–æ—Å–µ—â–µ–Ω–∏—è POI (TSP)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–≤—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è)
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ—Ñ–µ-–±—Ä–µ–π–∫–∏
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é –º–∞—Ä—à—Ä—É—Ç–∞

#### –ü–æ—á–µ–º—É NetworkX?

**ADR-0001** –æ–±—ä—è—Å–Ω—è–µ—Ç –≤—ã–±–æ—Ä:

1. **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã TSP**
   - `greedy_tsp` ‚Üí –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—è –∑–∞ O(n¬≤)
   - Christofides algorithm ‚Üí –≥–∞—Ä–∞–Ω—Ç–∏—è 1.5x –æ—Ç –æ–ø—Ç–∏–º—É–º–∞
   - –ù–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å–≤–æ–π TSP solver

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—à–∏—Ö –∑–∞–¥–∞—á**
   - 3-8 POI –Ω–∞ –º–∞—Ä—à—Ä—É—Ç ‚Üí <100ms —Ä–∞—Å—á–µ—Ç–∞
   - –ï—Å–ª–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—Å—è –¥–æ 20 POI ‚Üí –º–æ–∂–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ 2-opt, Lin-Kernighan

3. **–ì—Ä–∞—Ñ –∫–∞–∫ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è**
   - –í–µ—Ä—à–∏–Ω—ã = POI + start location
   - –†—ë–±—Ä–∞ = –ø–µ—à–µ—Ö–æ–¥–Ω—ã–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
   - –í–µ—Å–∞ = –≤—Ä–µ–º—è –≤ –ø—É—Ç–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- ‚ùå Google OR-Tools ‚Üí overkill –¥–ª—è 8 —Ç–æ—á–µ–∫, —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚ùå OSRM API ‚Üí –≤–Ω–µ—à–Ω—è—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, latency, rate limits
- ‚ùå –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π greedy –∞–ª–≥–æ—Ä–∏—Ç–º ‚Üí –∑–∞—á–µ–º –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥?

#### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```python
# 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç—ã (–∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ top-K POI)
candidates = generate_combinations(
    ranked_pois,
    target_count=calculate_poi_count(duration, intensity)
)

# 2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
for candidate in candidates:
    # 2.1 –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
    G = nx.complete_graph(len(candidate) + 1)  # +1 –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
    for i, j in G.edges():
        G[i][j]["weight"] = walking_distance(nodes[i], nodes[j])

    # 2.2 –†–µ—à–∞–µ–º TSP
    route = nx.approximation.greedy_tsp(G, source=0)

    # 2.3 –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    total_time = sum(poi.avg_visit_minutes for poi in route)
    total_time += sum(edge_weights)

    if total_time <= available_time:
        valid_routes.append((route, total_time))

# 3. –í—ã–±–∏—Ä–∞–µ–º –ª—É—á—à–∏–π –º–∞—Ä—à—Ä—É—Ç
best_route = max(valid_routes, key=lambda r: len(r[0]))
```

#### Intensity-aware –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**ADR-0001** –≤–≤–µ–ª –ø–æ–Ω—è—Ç–∏–µ "intensity profiles":

```python
INTENSITY_PROFILES = {
    "relaxed": {
        "target_per_hour": 1.5,    # 3 POI –∑–∞ 2 —á–∞—Å–∞
        "visit_duration": (20, 45), # –º–∏–Ω
        "transition_padding": 1.15, # +15% –Ω–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        "safety_buffer": 0.85,      # -15% —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞
    },
    "medium": {
        "target_per_hour": 2.0,    # 4 POI –∑–∞ 2 —á–∞—Å–∞
        "visit_duration": (15, 30),
        "transition_padding": 1.10,
        "safety_buffer": 0.90,
    },
    "intense": {
        "target_per_hour": 2.5,    # 5 POI –∑–∞ 2 —á–∞—Å–∞
        "visit_duration": (10, 20),
        "transition_padding": 1.05,
        "safety_buffer": 0.95,
    },
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?**
- –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≥–æ–≤–æ—Ä–∏—Ç: "relaxed = –º–µ–Ω—å—à–µ –º–µ—Å—Ç, –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ"
- –ú—ã —Ñ–æ—Ä–º–∞–ª–∏–∑—É–µ–º: 1.5 POI/—á–∞—Å = 3 –º–µ—Å—Ç–∞ –∑–∞ 2 —á–∞—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–≤–æ–ª–µ–Ω: –Ω–µ –±–µ–∂–∏—Ç –≥–∞–ª–æ–ø–æ–º, —É—Å–ø–µ–≤–∞–µ—Ç –≤—Å—ë –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å

#### –ö–æ—Ñ–µ-–±—Ä–µ–π–∫–∏

```python
if request.coffee_break:
    # –ò—â–µ–º –∫–∞—Ñ–µ –≤ —Ä–∞–¥–∏—É—Å–µ 500–º –æ—Ç —Å–µ—Ä–µ–¥–∏–Ω—ã –º–∞—Ä—à—Ä—É—Ç–∞
    cafes = await poi_service.find_cafes_near(
        midpoint, radius=500
    )
    # –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –º–∞—Ä—à—Ä—É—Ç –º–µ–∂–¥—É POI
    route.insert(middle_index, best_cafe)
```

**2GIS API –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞—Ñ–µ:**
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã, —Ä–µ–π—Ç–∏–Ω–≥–∏)
- –§–∏–ª—å—Ç—Ä—ã (–∫–æ—Ñ–µ–π–Ω–∏, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –±–∞—Ä—ã)
- Fallback: –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ñ–µ-–±—Ä–µ–π–∫

---

### 6. LLM Service (Python + OpenAI/Anthropic)

**–ü—É—Ç—å:** `services/llm-service/`
**–ü–æ—Ä—Ç:** 50054 (gRPC), 9094 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** OpenAI SDK, Anthropic SDK, Tenacity (retry)

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ POI
- Fallback –Ω–∞ —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ API –∫–ª—é—á–µ–π

#### –ü–æ—á–µ–º—É Claude Sonnet 4?

**–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏:** `claude-sonnet-4-20250514`

1. **–ö–∞—á–µ—Å—Ç–≤–æ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞**
   - Claude –æ—Ç–ª–∏—á–Ω–æ –ø–∏—à–µ—Ç –ø–æ-—Ä—É—Å—Å–∫–∏ (vs GPT-4 —á—É—Ç—å —Ö—É–∂–µ)
   - –ü–æ–Ω–∏–º–∞–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ù–∏–∂–Ω–µ–≥–æ –ù–æ–≤–≥–æ—Ä–æ–¥–∞
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è, –Ω–µ —à–∞–±–ª–æ–Ω–Ω—ã–µ

2. **–°—Ç–æ–∏–º–æ—Å—Ç—å vs –∫–∞—á–µ—Å—Ç–≤–æ**
   - Sonnet 4: $3/1M input tokens, $15/1M output
   - GPT-4o: $2.50/1M input, $10/1M output
   - –î–ª—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ —ç–∫–æ–Ω–æ–º–∏–∏

3. **–î–ª–∏–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**
   - 200K tokens ‚Üí –º–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å –≤–µ—Å—å –º–∞—Ä—à—Ä—É—Ç + –æ–ø–∏—Å–∞–Ω–∏—è POI
   - –ú–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É –º–µ—Å—Ç–∞–º–∏
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤—è–∑–Ω—ã–π –Ω–∞—Ä—Ä–∞—Ç–∏–≤, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫—É—Å–∫–∏

4. **Latency**
   - Streaming responses ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
   - Time to first token ~500ms
   - –î–ª—è –Ω–∞—à–µ–≥–æ use case (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞) –ø—Ä–∏–µ–º–ª–µ–º–æ

#### Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

```python
async def generate_explanation(route: Route) -> str:
    if not ANTHROPIC_API_KEY and not OPENAI_API_KEY:
        # –®–∞–±–ª–æ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ LLM
        return f"""
        –ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω —Å —É—á—ë—Ç–æ–º –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤.
        –í—ã –ø–æ—Å–µ—Ç–∏—Ç–µ {len(route.pois)} –º–µ—Å—Ç –∑–∞ {route.duration} –º–∏–Ω—É—Ç.
        –û–±—â–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è: {route.distance}–º.
        """

    try:
        # –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å LLM —Å retry (3 –ø–æ–ø—ã—Ç–∫–∏)
        return await llm_client.generate(route)
    except Exception as e:
        logger.warning(f"LLM failed: {e}, using fallback")
        return generate_template_explanation(route)
```

**–ó–∞—á–µ–º fallback?**
- –î–µ–º–æ –¥–ª—è –∂—é—Ä–∏ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ API –∫–ª—é—á–µ–π
- Graceful degradation: —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –±–µ–∑ AI-–æ–ø–∏—Å–∞–Ω–∏–π
- Production: –µ—Å–ª–∏ API —É–ø–∞–ª ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è

#### Retry –ª–æ–≥–∏–∫–∞

```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=2, max=10)
)
async def call_llm(prompt: str) -> str:
    response = await anthropic.messages.create(
        model="claude-sonnet-4-20250514",
        max_tokens=1024,
        messages=[{"role": "user", "content": prompt}]
    )
    return response.content[0].text
```

**–ó–∞—á–µ–º retry?**
- API –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞—Ç—å (rate limit, timeout)
- Exponential backoff: 2s, 4s, 8s ‚Üí –Ω–µ DDoS-–∏–º API
- 3 –ø–æ–ø—ã—Ç–∫–∏ ‚Üí balance –º–µ–∂–¥—É reliability –∏ latency

---

### 7. Geocoding Service (Python + 2GIS API)

**–ü—É—Ç—å:** `services/geocoding-service/`
**–ü–æ—Ä—Ç:** 50055 (gRPC), 9095 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** httpx, 2GIS API

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∞–¥—Ä–µ—Å–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∞–¥—Ä–µ—Å–∞ (–ì–æ—Ä—å–∫–æ–≥–æ ‚Üí —É–ª. –ì–æ—Ä—å–∫–æ–≥–æ, –¥. 1)

#### –ü–æ—á–µ–º—É 2GIS?

1. **–õ—É—á—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –†–æ—Å—Å–∏–∏**
   - Google Maps –ø–ª–æ—Ö–æ –∑–Ω–∞–µ—Ç –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥
   - 2GIS —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –†–§, –°–ù–ì
   - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é)

2. **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier**
   - 25K –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ
   - –î–ª—è MVP –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
   - –ï—Å–ª–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—Å—è ‚Üí –µ—Å—Ç—å –ø–ª–∞—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã

3. **API –∫–∞—á–µ—Å—Ç–≤–æ**
   - RESTful JSON API
   - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ fuzzy search ("–ì–æ—Ä—å–∫–æ–≥–æ" –Ω–∞–π–¥–µ—Ç "—É–ª. –ì–æ—Ä—å–∫–æ–≥–æ")

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- ‚ùå Google Geocoding API ‚Üí $5/1K requests, –ø–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤ –†–æ—Å—Å–∏–∏
- ‚ùå Yandex Maps API ‚Üí —Ö–æ—Ä–æ—à–∏–π, –Ω–æ –¥–æ—Ä–æ–∂–µ 2GIS
- ‚ùå Nominatim (OpenStreetMap) ‚Üí –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π –∏ –Ω–µ—Ç–æ—á–Ω—ã–π

---

### 8. POI Service (Python + PostgreSQL)

**–ü—É—Ç—å:** `services/poi-service/`
**–ü–æ—Ä—Ç:** 50056 (gRPC), 9096 (Metrics)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** SQLAlchemy, asyncpg, PostgreSQL 16

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?
- CRUD –¥–ª—è —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ—Ä–µ—Å–∞
- –•—Ä–∞–Ω–∏—Ç embeddings (–º–∞—Å—Å–∏–≤—ã float[384])
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ü–æ–∏—Å–∫ –∫–∞—Ñ–µ —á–µ—Ä–µ–∑ 2GIS API

#### –°—Ö–µ–º–∞ –ë–î

```sql
CREATE TABLE pois (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    lat FLOAT NOT NULL,
    lon FLOAT NOT NULL,
    category VARCHAR(100),
    tags TEXT[],
    description TEXT,
    rating FLOAT,
    avg_visit_minutes INT,
    embedding FLOAT[],           -- 384-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä
    social_mode VARCHAR(50),     -- solo/friends/couple/family/any
    intensity_level VARCHAR(50), -- relaxed/medium/intense
    open_time TIME,
    close_time TIME,
    photo_tip TEXT,
    local_tip TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_category ON pois(category);
CREATE INDEX idx_social_mode ON pois(social_mode);
CREATE INDEX idx_intensity ON pois(intensity_level);
```

**–ü–æ—á–µ–º—É PostgreSQL?**

1. **ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
   - –ì–∞—Ä–∞–Ω—Ç–∏–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
   - Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–≥—Ä—É–∑–∫–∏

2. **Array –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
   - –ú–æ–∂–µ–º —Ö—Ä–∞–Ω–∏—Ç—å embeddings –∫–∞–∫ FLOAT[]
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ embeddings ‚Üí –±–æ–ª—å—à–µ JOIN'–æ–≤

3. **JSON –ø–æ–¥–¥–µ—Ä–∂–∫–∞**
   - –ú–æ–∂–µ–º —Ö—Ä–∞–Ω–∏—Ç—å tags –∫–∞–∫ JSONB
   - –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ GIN index
   - –ì–∏–±–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã: `tags @> '["–∏—Å—Ç–æ—Ä–∏—è"]'`

4. **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è**
   - pgvector –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–±—É–¥—É—â–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
   - PostGIS –¥–ª—è –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - pg_trgm –¥–ª—è fuzzy text search

**–ü–æ—á–µ–º—É –ù–ï MongoDB?**
- POI –∏–º–µ—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É ‚Üí SQL –ø–æ–¥—Ö–æ–¥–∏—Ç –ª—É—á—à–µ
- –ù–µ—Ç –Ω—É–∂–¥—ã –≤ horizontal sharding (150 POI, –Ω–µ 150M)
- PostgreSQL —É–º–µ–µ—Ç –≤ JSON ‚Üí best of both worlds

**–ü–æ—á–µ–º—É asyncpg?**
- Async –¥—Ä–∞–π–≤–µ—Ä ‚Üí –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
- 3x –±—ã—Å—Ç—Ä–µ–µ psycopg2 (sync –¥—Ä–∞–π–≤–µ—Ä)
- –†–∞–±–æ—Ç–∞–µ—Ç —Å asyncio event loop

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è

### gRPC vs REST –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

**–í—ã–±—Ä–∞–ª–∏:** gRPC (HTTP/2 + Protocol Buffers)

#### –ü–æ—á–µ–º—É gRPC?

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - Protobuf –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí 3-10x –º–µ–Ω—å—à–µ JSON
   - HTTP/2 multiplexing ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω–æ–º TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
   - Latency: 5-10ms vs 20-50ms —É REST

2. **–°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç**
   - `.proto` —Ñ–∞–π–ª—ã ‚Üí API –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –≤–∏–¥–Ω—ã —Å—Ä–∞–∑—É ‚Üí –º–µ–Ω—å—à–µ runtime –æ—à–∏–±–æ–∫
   - –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí –Ω–µ –ø–∏—à–µ–º boilerplate

3. **Streaming**
   - Server streaming: –º–æ–∂–µ–º —Å—Ç—Ä–∏–º–∏—Ç—å –±–æ–ª—å—à–∏–µ —Å–ø–∏—Å–∫–∏ POI
   - Bidirectional streaming: –¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ–∏—á (real-time updates)

4. **–ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è**
   - `protoc` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥ –Ω–∞ Python, Go, Java, etc.
   - Type-safe –∫–ª–∏–µ–Ω—Ç—ã ‚Üí IDE –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ proto packages

**–ö–æ–≥–¥–∞ –ù–ï —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gRPC:**
- Frontend ‚Üî Backend ‚Üí –±—Ä–∞—É–∑–µ—Ä—ã –ø–ª–æ—Ö–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç HTTP/2 (–Ω—É–∂–µ–Ω grpc-web)
- Public API ‚Üí REST –±–æ–ª–µ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –ª–µ–≥—á–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- –ü—Ä–æ—Å—Ç—ã–µ CRUD ‚Üí REST –ø—Ä–æ—â–µ –¥–ª—è –º–µ–ª–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

**–ù–∞—à –ø–æ–¥—Ö–æ–¥:**
- Frontend ‚Üî API Gateway: **REST** (–ø—Ä–∏–≤—ã—á–Ω—ã–π HTTP/JSON)
- Backend ‚Üî Backend: **gRPC** (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

---

### Poetry –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

**–í—ã–±—Ä–∞–ª–∏:** Poetry –≤–º–µ—Å—Ç–æ pip/requirements.txt

#### –ü–æ—á–µ–º—É Poetry?

1. **–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–±–æ—Ä–∫–∏**
   - `poetry.lock` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤–µ—Ä—Å–∏–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - `pip install -r requirements.txt` –º–æ–∂–µ—Ç –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
   - Reproducible builds ‚Üí dev = staging = production

2. **–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
   - Poetry —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - pip –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É "–∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π X –∏ Y"

3. **–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏–∑ –∫–æ—Ä–æ–±–∫–∏**
   - `poetry install` —Å–æ–∑–¥–∞–µ—Ç venv –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ù–µ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å `python -m venv .venv && source .venv/bin/activate`

4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ dev/prod –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
   ```toml
   [tool.poetry.dependencies]
   python = "^3.11"
   fastapi = "^0.109.0"

   [tool.poetry.group.dev.dependencies]
   pytest = "^7.4.0"
   black = "^23.0.0"
   ```
   - `poetry install --no-dev` ‚Üí production –æ–±—Ä–∞–∑ –º–µ–Ω—å—à–µ

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- ‚ùå pip + requirements.txt ‚Üí –Ω–µ—Ç lock —Ñ–∞–π–ª–∞, –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π
- ‚úÖ pipenv ‚Üí —Ö–æ—Ä–æ—à, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ Poetry
- ‚úÖ conda ‚Üí –¥–ª—è data science, overkill –¥–ª—è –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤

---

### Docker Multi-stage builds

**–ü—Ä–∏–º–µ—Ä:** `services/api-gateway/Dockerfile`

```dockerfile
# Stage 1: Builder
FROM python:3.11-slim as builder
WORKDIR /app
RUN pip install poetry
COPY pyproject.toml poetry.lock ./
RUN poetry export -f requirements.txt > requirements.txt

# Stage 2: Runtime
FROM python:3.11-slim
WORKDIR /app
COPY --from=builder /app/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY app/ ./app/
CMD ["python", "-m", "app.main"]
```

#### –ó–∞—á–µ–º multi-stage?

1. **–ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞**
   - Builder stage: 500 MB (poetry, build tools)
   - Runtime stage: 200 MB (—Ç–æ–ª—å–∫–æ Python + –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
   - –≠–∫–æ–Ω–æ–º–∏–º 60% —Ä–∞–∑–º–µ—Ä–∞

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - Build tools (gcc, make) –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ production –æ–±—Ä–∞–∑
   - –ú–µ–Ω—å—à–µ attack surface –¥–ª—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤**
   - `COPY pyproject.toml poetry.lock` ‚Üí –∫–µ—à–∏—Ä—É–µ—Ç—Å—è
   - –ò–∑–º–µ–Ω–∏–ª–∏ –∫–æ–¥ ‚Üí –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–π

---

### Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:**
- Embedding Service: –∫–µ—à –≤–µ–∫—Ç–æ—Ä–æ–≤
- Route Planner Service: –∫–µ—à –º–∞—Ä—à—Ä—É—Ç–æ–≤
- API Gateway: session store

#### –ü–æ—á–µ–º—É Redis?

1. **In-memory —Å–∫–æ—Ä–æ—Å—Ç—å**
   - Latency: <1ms vs 10-50ms —É PostgreSQL
   - Throughput: 100K ops/sec –Ω–∞ —Å—Ä–µ–¥–Ω–µ–π –º–∞—à–∏–Ω–µ

2. **TTL –∏–∑ –∫–æ—Ä–æ–±–∫–∏**
   - `SETEX key 3600 value` ‚Üí –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ —á–∞—Å
   - –ù–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å cronjob –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**
   - Key-value store ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π API
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä (lists, sets, hashes) –¥–ª—è –±—É–¥—É—â–µ–≥–æ

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
- ‚ùå Memcached ‚Üí –ø—Ä–æ—â–µ Redis, –Ω–æ –Ω–µ—Ç persistence
- ‚ùå PostgreSQL ‚Üí —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω—ã–π –¥–ª—è –∫–µ—à–∞
- ‚úÖ In-process cache (dict) ‚Üí —Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ pod'–∞

---

### Prometheus –¥–ª—è –º–µ—Ç—Ä–∏–∫

**–ü–æ—Ä—Ç—ã –º–µ—Ç—Ä–∏–∫:**
- API Gateway: 9090
- Embedding Service: 9091
- Ranking Service: 9092
- ... (–∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å)

#### –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–º?

```python
# Python - prometheus_client
from prometheus_client import Counter, Histogram

request_count = Counter("api_requests_total", "Total requests")
request_duration = Histogram("api_request_duration_seconds", "Request duration")

@app.middleware("http")
async def metrics_middleware(request, call_next):
    request_count.inc()
    with request_duration.time():
        response = await call_next(request)
    return response
```

**–ú–µ—Ç—Ä–∏–∫–∏:**
- `api_requests_total` ‚Üí —Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏
- `api_request_duration_seconds` ‚Üí latency (p50, p95, p99)
- `grpc_requests_total` ‚Üí gRPC –≤—ã–∑–æ–≤—ã
- `embedding_cache_hits` ‚Üí hit rate –∫–µ—à–∞

**–ó–∞—á–µ–º Prometheus?**
- –°—Ç–∞–Ω–¥–∞—Ä—Ç –≤ Kubernetes
- Pull-based ‚Üí —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–Ω–∞—é—Ç, –∫—Ç–æ –∏—Ö —Å–∫—Ä–µ–π–ø–∏—Ç
- PromQL –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ Grafana

---

## üöÄ DevOps –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### Kubernetes + Helm

**–ó–∞—á–µ–º Kubernetes –¥–ª—è MVP?**

–ú–Ω–æ–≥–∏–µ —Å–∫–∞–∂—É—Ç: "Kubernetes overkill –¥–ª—è MVP, Docker Compose –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ".

**–ü–æ—á–µ–º—É –º—ã –≤—ã–±—Ä–∞–ª–∏ K8s:**

1. **Production-ready —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è**
   - –ù–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ Docker Compose ‚Üí K8s –ø–æ—Ç–æ–º
   - Deployment strategy (RollingUpdate) ‚Üí zero-downtime deploys
   - Self-healing: pod —É–ø–∞–ª ‚Üí Kubernetes –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - `replicas: 2` ‚Üí –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –∫–æ—Ä–æ–±–∫–∏
   - HPA (Horizontal Pod Autoscaler) ‚Üí auto-scaling –ø–æ CPU/RAM

3. **Declarative –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
   - YAML –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã ‚Üí –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥
   - Git = source of truth
   - Rollback: `helm rollback ai-tourist 1`

4. **–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞**
   - Ingress –¥–ª—è —Ä–æ—É—Ç–∏–Ω–≥–∞
   - Secrets –¥–ª—è API –∫–ª—é—á–µ–π
   - ConfigMaps –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - Jobs –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

**Helm = package manager –¥–ª—è K8s**

```yaml
# helm/ai-tourist/values.yaml
apiGateway:
  replicas: 2
  resources:
    requests: {memory: "256Mi", cpu: "200m"}
    limits: {memory: "512Mi", cpu: "500m"}
```

- –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: `helm upgrade --install ai-tourist ./helm/ai-tourist/`
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è: `.env.yaml` ‚Üí values
- –®–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—è: `{{ .Values.apiGateway.replicas }}`

---

### Minikube –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ó–∞—á–µ–º Minikube?**

- –õ–æ–∫–∞–ª—å–Ω—ã–π K8s –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ
- –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ –¥–µ–ø–ª–æ—è –≤ production
- –ñ—é—Ä–∏ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –ª–æ–∫–∞–ª—å–Ω–æ

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```bash
minikube start --driver=docker --cpus=6 --memory=12g
minikube addons enable ingress
minikube addons enable metrics-server
```

**Addons:**
- `ingress` ‚Üí nginx ingress controller
- `metrics-server` ‚Üí CPU/RAM –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è HPA

---

### Makefile –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

```makefile
all: build deploy test

build:
    # –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤ –≤ Minikube docker-env
    eval $(minikube docker-env) && docker build ...

deploy:
    # Helm —É—Å—Ç–∞–Ω–æ–≤–∫–∞/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    helm upgrade --install ai-tourist ./helm/ai-tourist/

test:
    # Smoke tests –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
    kubectl run test --image=curlimages/curl -- curl http://api-gateway:8000/health
```

**–ó–∞—á–µ–º Makefile?**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `make all` ‚Üí –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –∑–Ω–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ K8s
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥: `$(GREEN)‚úÖ Build complete$(NC)`

---

### Health Checks

**Liveness vs Readiness:**

```yaml
# Kubernetes manifest
livenessProbe:
  httpGet:
    path: /healthz
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /readyz
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 5
```

**–õ–æ–≥–∏–∫–∞:**

1. **Liveness (/healthz)**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –ø—Ä–æ—Ü–µ—Å—Å –∂–∏–≤?
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí Kubernetes —É–±–∏–≤–∞–µ—Ç pod –∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: deadlock, memory leak

2. **Readiness (/readyz)**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: —Å–µ—Ä–≤–∏—Å –≥–æ—Ç–æ–≤ –∫ —Ç—Ä–∞—Ñ–∏–∫—É?
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí Kubernetes –Ω–µ —à–ª–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∂–¥–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, –ø—Ä–æ–≥—Ä–µ–≤–∞ –∫–µ—à–∞

**–ü—Ä–∏–º–µ—Ä readyz:**

```python
@app.get("/readyz")
async def readiness():
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º gRPC —Å–µ—Ä–≤–∏—Å—ã
    services_ok = await grpc_clients.health_check()

    if not all(services_ok.values()):
        return JSONResponse(
            {"ready": False, "dependencies": services_ok},
            status_code=503
        )

    return {"ready": True}
```

---

### Secrets Management

**–ü—Ä–æ–±–ª–µ–º–∞:** API –∫–ª—é—á–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ Git

**–†–µ—à–µ–Ω–∏–µ:**

1. `.env.example` ‚Üí —à–∞–±–ª–æ–Ω –≤ Git
2. `.env` ‚Üí –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ (–≤ .gitignore)
3. `scripts/env-to-yaml.sh` ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç .env ‚Üí `helm/ai-tourist/secrets.yaml`
4. Helm —á–∏—Ç–∞–µ—Ç secrets.yaml ‚Üí —Å–æ–∑–¥–∞–µ—Ç Kubernetes Secrets

```yaml
# secrets.yaml (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
secrets:
  anthropicApiKey: "sk-ant-..."
  openaiApiKey: "sk-proj-..."
  twogisApiKey: "..."
```

**–í pod'–µ:**

```yaml
env:
  - name: ANTHROPIC_API_KEY
    valueFrom:
      secretKeyRef:
        name: ai-tourist-secrets
        key: anthropicApiKey
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- Secrets –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ etcd
- –î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ pod'–∞–º –≤ namespace
- –†–æ—Ç–∞—Ü–∏—è: –º–µ–Ω—è–µ–º secret ‚Üí —Ä–µ—Å—Ç–∞—Ä—Ç—É–µ–º pod'—ã

---

### Jobs –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

**POI Loader Job:**

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: poi-loader
  annotations:
    "helm.sh/hook": post-install,post-upgrade
spec:
  template:
    spec:
      containers:
      - name: loader
        image: ai-tourist-poi-service:latest
        command: ["python", "scripts/load_pois.py"]
        env:
          - name: DATABASE_URL
            value: "postgresql://..."
```

**Helm hooks:**
- `post-install` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è
- `post-upgrade` ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ó–∞—á–µ–º Job –≤–º–µ—Å—Ç–æ init container?**
- Job –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å (retry)
- –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `kubectl logs job/poi-loader`
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—Ç –¥—Ä—É–≥–∏—Ö pod'–æ–≤

---

## üîÄ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### Request Flow: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞

**1. User ‚Üí Frontend**
```javascript
const response = await fetch('/api/v1/routes/plan', {
  method: 'POST',
  body: JSON.stringify({
    interests: ["–∏—Å—Ç–æ—Ä–∏—è", "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"],
    socialMode: "couple",
    intensity: "medium",
    duration: 180,
    startLocation: {lat: 56.3287, lon: 44.002}
  })
});
```

**2. Frontend ‚Üí API Gateway (REST)**
```
POST /api/v1/routes/plan
Content-Type: application/json

{interests, socialMode, intensity, duration, startLocation}
```

**3. API Gateway ‚Üí Embedding Service (gRPC)**
```protobuf
message EmbeddingRequest {
  string text = 1;  // "–∏—Å—Ç–æ—Ä–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"
}

message EmbeddingResponse {
  repeated float embedding = 1;  // [0.123, -0.456, ...]
}
```

**4. API Gateway ‚Üí POI Service (gRPC)**
```protobuf
message GetPOIsRequest {}

message GetPOIsResponse {
  repeated POI pois = 1;
}

message POI {
  int32 id = 1;
  string name = 2;
  double lat = 3;
  double lon = 4;
  string category = 5;
  // ...
}
```

**5. API Gateway ‚Üí Ranking Service (gRPC)**
```protobuf
message RankingRequest {
  repeated float user_embedding = 1;
  string social_mode = 2;
  string intensity = 3;
  repeated string categories_filter = 4;
  int32 start_time_minutes = 5;
  int32 top_k = 6;
}

message RankingResponse {
  repeated ScoredPOI scored_pois = 1;
}

message ScoredPOI {
  int32 poi_id = 1;
  string name = 2;
  double lat = 3;
  double lon = 4;
  double score = 5;
  // ...
}
```

**6. API Gateway ‚Üí Route Planner Service (gRPC)**
```protobuf
message RouteOptimizationRequest {
  repeated ScoredPOI candidate_pois = 1;
  Location start_location = 2;
  int32 available_minutes = 3;
  string intensity = 4;
  bool include_coffee_break = 5;
}

message RouteOptimizationResponse {
  repeated POI route_pois = 1;
  double total_distance_meters = 2;
  int32 total_duration_minutes = 3;
  repeated Location geometry = 4;  // LineString
}
```

**7. API Gateway ‚Üí LLM Service (gRPC)**
```protobuf
message RouteExplanationRequest {
  repeated POI pois = 1;
  string social_mode = 2;
  string intensity = 3;
  string user_interests = 4;
}

message RouteExplanationResponse {
  string explanation = 1;
  repeated string poi_tips = 2;
}
```

**8. API Gateway ‚Üí Frontend (REST)**
```json
{
  "route": {
    "pois": [
      {
        "id": 1,
        "name": "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∏–π –ö—Ä–µ–º–ª—å",
        "lat": 56.3287,
        "lon": 44.002,
        "category": "monument",
        "avgVisitMinutes": 45,
        "tip": "–ü–æ–¥–Ω–∏–º–∏—Ç–µ—Å—å –Ω–∞ –±–∞—à–Ω—é –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º–Ω–æ–≥–æ –≤–∏–¥–∞"
      },
      // ...
    ],
    "totalDistance": 3200,
    "totalDuration": 180,
    "geometry": [[56.3287, 44.002], [56.3301, 44.005], ...]
  },
  "explanation": "–≠—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–∞—Ä—ã, –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–π—Å—è –∏—Å—Ç–æ—Ä–∏–µ–π...",
  "coffeeBreak": {
    "name": "–ö–æ—Ñ–µ–π–Ω—è –Ω–∞ –ë–æ–ª—å—à–æ–π –ü–æ–∫—Ä–æ–≤—Å–∫–æ–π",
    "lat": 56.3295,
    "lon": 44.003
  }
}
```

**9. Frontend ‚Üí User**
- –†–µ–Ω–¥–µ—Ä–∏—Ç –∫–∞—Ä—Ç—É —Å –º–∞—Ä—à—Ä—É—Ç–æ–º (React Leaflet)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å–æ–≤–µ—Ç—ã
- –ê–Ω–∏–º–∞—Ü–∏—è —á–µ—Ä–µ–∑ Framer Motion

---

### Trace ID –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ 6 —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–∞–∫ –¥–µ–±–∞–∂–∏—Ç—å?

**–†–µ—à–µ–Ω–∏–µ:** Distributed Tracing —Å trace_id

```python
# API Gateway –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç trace_id
trace_id = str(uuid.uuid4())
set_trace_id(trace_id)

# –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ gRPC metadata
metadata = [("x-trace-id", trace_id)]
await embedding_client.generate(text, metadata=metadata)

# Embedding Service –ª–æ–≥–∏—Ä—É–µ—Ç —Å trace_id
logger.info(f"[{trace_id}] Generating embedding for: {text}")

# –í—Å–µ –ª–æ–≥–∏ –∏–º–µ—é—Ç trace_id
# Grep –ø–æ trace_id ‚Üí –≤–∏–¥–∏–º –≤–µ—Å—å –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
```

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:**

```
[api-gateway] [trace-123] POST /api/v1/routes/plan
[embedding-service] [trace-123] Generating embedding for: "–∏—Å—Ç–æ—Ä–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"
[ranking-service] [trace-123] Ranking 150 POIs
[route-planner] [trace-123] Optimizing route for 6 candidates
[llm-service] [trace-123] Generating explanation
[api-gateway] [trace-123] Response sent in 1.2s
```

---

## üßÆ –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏

### Cosine Similarity –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞

**–§–æ—Ä–º—É–ª–∞:**

```
similarity(A, B) = (A ¬∑ B) / (||A|| * ||B||)

–≥–¥–µ:
A ¬∑ B = —Å–∫–∞–ª—è—Ä–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (sum(A[i] * B[i]))
||A|| = –Ω–æ—Ä–º–∞ –≤–µ–∫—Ç–æ—Ä–∞ (sqrt(sum(A[i]¬≤)))
```

**–ü—Ä–∏–º–µ—Ä:**

```python
user_embedding = [0.5, 0.3, -0.2, ...]  # 384 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å
poi_embedding = [0.6, 0.4, -0.1, ...]

dot_product = np.dot(user_embedding, poi_embedding)
norm_user = np.linalg.norm(user_embedding)
norm_poi = np.linalg.norm(poi_embedding)

similarity = dot_product / (norm_user * norm_poi)  # 0.0 ... 1.0
```

**–ü–æ—á–µ–º—É cosine, –∞ –Ω–µ euclidean distance?**

- Cosine —É—á–∏—Ç—ã–≤–∞–µ—Ç **–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –≤–µ–∫—Ç–æ—Ä–∞, –Ω–µ –¥–ª–∏–Ω—É
- "–∏—Å—Ç–æ—Ä–∏—è" –∏ "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞" ‚Üí –±–ª–∏–∑–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- Euclidean —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∫ –º–∞—Å—à—Ç–∞–±—É

---

### Travelling Salesman Problem (TSP)

**–ó–∞–¥–∞—á–∞:** –¥–∞–Ω–æ N —Ç–æ—á–µ–∫, –Ω–∞–π—Ç–∏ –∫—Ä–∞—Ç—á–∞–π—à–∏–π –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ –≤—Å–µ —Ç–æ—á–∫–∏.

**NP-hard:** –Ω–µ—Ç polynomial time –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.

**–ù–∞—à –ø–æ–¥—Ö–æ–¥:**

1. **Greedy TSP (NetworkX)**
   - –ù–∞—á–∏–Ω–∞–µ–º —Å–æ start location
   - –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –∏–¥–µ–º –≤ –±–ª–∏–∂–∞–π—à—É—é –Ω–µ–ø–æ—Å–µ—â–µ–Ω–Ω—É—é —Ç–æ—á–∫—É
   - Complexity: O(n¬≤)
   - Approximation ratio: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≥—Ä–∞—Ñ–∞, –æ–±—ã—á–Ω–æ 1.2-1.5x –æ–ø—Ç–∏–º—É–º–∞

2. **Christofides (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
   - –ì–∞—Ä–∞–Ω—Ç–∏—è: –Ω–µ –±–æ–ª—å—à–µ 1.5x –æ–ø—Ç–∏–º—É–º–∞
   - –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º, –µ—Å–ª–∏ greedy –¥–∞—ë—Ç –ø–ª–æ—Ö–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü–æ—á–µ–º—É –Ω–µ —Ç–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ?**

- –î–ª—è 8 —Ç–æ—á–µ–∫ –µ—Å—Ç—å 8! = 40320 –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫
- –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä: 40320 * O(distance calc) ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ
- Greedy —Ä–µ—à–µ–Ω–∏–µ –∑–∞ 50ms ‚Üí –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### Intensity-aware POI count

**–§–æ—Ä–º—É–ª–∞:**

```python
target_pois = (available_minutes / 60) * profile["target_per_hour"]

# –ü—Ä–∏–º–µ—Ä:
# available_minutes = 180 (3 —á–∞—Å–∞)
# intensity = "medium" ‚Üí target_per_hour = 2.0
# target_pois = (180 / 60) * 2.0 = 6
```

**Safety buffer:**

```python
effective_budget = available_minutes * profile["safety_buffer"]

# safety_buffer = 0.85 –¥–ª—è relaxed
# effective_budget = 180 * 0.85 = 153 –º–∏–Ω—É—Ç—ã
# –û—Å—Ç–∞–≤–ª—è–µ–º 27 –º–∏–Ω—É—Ç –∑–∞–ø–∞—Å–∞ –Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∏
```

---

## üìä –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### Horizontal Pod Autoscaler (HPA)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-gateway-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: api-gateway
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

**–õ–æ–≥–∏–∫–∞:**
- CPU > 70% ‚Üí –¥–æ–±–∞–≤–∏—Ç—å pod
- CPU < 30% ‚Üí —É–±—Ä–∞—Ç—å pod (scale down)
- Min 2 replicas ‚Üí –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å backup
- Max 10 replicas ‚Üí –Ω–µ –≤–∑–æ—Ä–≤–µ–º –∫–ª–∞—Å—Ç–µ—Ä

---

### Circuit Breaker –¥–ª—è gRPC

**–ü—Ä–æ–±–ª–µ–º–∞:** LLM Service —É–ø–∞–ª ‚Üí –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–∏—Å—è—Ç 30s timeout

**–†–µ—à–µ–Ω–∏–µ:** Circuit Breaker

```python
from tenacity import retry, stop_after_attempt

class CircuitBreaker:
    def __init__(self, failure_threshold=5):
        self.failures = 0
        self.threshold = failure_threshold
        self.state = "closed"  # closed, open, half-open

    async def call(self, func, *args):
        if self.state == "open":
            raise CircuitBreakerOpen("Too many failures")

        try:
            result = await func(*args)
            self.failures = 0  # reset on success
            return result
        except Exception as e:
            self.failures += 1
            if self.failures >= self.threshold:
                self.state = "open"
            raise
```

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- **Closed** (–Ω–æ—Ä–º–∞) ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã
- **Open** (–∞–≤–∞—Ä–∏—è) ‚Üí fail fast, –Ω–µ –¥–µ—Ä–≥–∞–µ–º —Å–µ—Ä–≤–∏—Å
- **Half-open** (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ) ‚Üí –ø—Ä–æ–±—É–µ–º 1 –∑–∞–ø—Ä–æ—Å, –µ—Å–ª–∏ ok ‚Üí closed

---

### Database Connection Pool

```python
engine = create_async_engine(
    DATABASE_URL,
    pool_size=10,          # 10 –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    max_overflow=20,       # +20 –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ
    pool_pre_ping=True,    # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    pool_recycle=3600      # –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å
)
```

**–ó–∞—á–µ–º pool?**
- –û—Ç–∫—Ä—ã—Ç–∏–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ PostgreSQL: 20-50ms
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: <1ms
- 100 RPS * 50ms = –ø–æ–ª–æ–≤–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ connections

---

### Rate Limiting (–±—É–¥—É—â–∞—è —Ñ–∏—á–∞)

```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.errors import RateLimitExceeded

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

@app.post("/api/v1/routes/plan")
@limiter.limit("10/minute")  # 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É —Å IP
async def plan_route(request: Request):
    ...
```

**–ó–∞—á–µ–º?**
- –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS
- –≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ LLM API (–¥–æ—Ä–æ–≥–∏–µ –≤—ã–∑–æ–≤—ã)
- Fair usage –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üéì Lessons Learned

### –ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –æ—Ç–ª–∏—á–Ω–æ?

1. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**
   - –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ü—Ä–æ—â–µ –¥–µ–±–∞–∂–∏—Ç—å (–ª–æ–≥–∏ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º)
   - –ú–æ–∂–µ–º –º–µ–Ω—è—Ç—å Embedding –º–æ–¥–µ–ª—å –±–µ–∑ –∫–∞—Å–∞–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞

2. **gRPC**
   - –ë—ã—Å—Ç—Ä–µ–µ REST
   - –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Üí –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤
   - –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤

3. **Poetry**
   - –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–±–æ—Ä–∫–∏
   - –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - Dev/prod —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

4. **Kubernetes + Helm**
   - Production-ready —Å—Ä–∞–∑—É
   - Rollback –∑–∞ 10 —Å–µ–∫—É–Ω–¥
   - Auto-healing

### –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å?

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ API Gateway**
   - –°–µ–π—á–∞—Å: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ gRPC
   - –£–ª—É—á—à–µ–Ω–∏–µ: –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

2. **Batch processing –¥–ª—è embeddings**
   - –°–µ–π—á–∞—Å: 1 –∑–∞–ø—Ä–æ—Å = 1 embedding
   - –£–ª—É—á—à–µ–Ω–∏–µ: –±–∞—Ç—á –∏–∑ 10 –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ ‚Üí 1 –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏

3. **Vector database –¥–ª—è POI**
   - –°–µ–π—á–∞—Å: –ø–æ–ª–Ω—ã–π —Å–∫–∞–Ω PostgreSQL
   - –£–ª—É—á—à–µ–Ω–∏–µ: pgvector –∏–ª–∏ Qdrant –¥–ª—è ANN search

4. **Observability**
   - –î–æ–±–∞–≤–∏—Ç—å Jaeger –¥–ª—è distributed tracing
   - Grafana –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫
   - Alerting —á–µ—Ä–µ–∑ Alertmanager

---

## üìö –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ADR-0001: Route Optimization](docs/adr/0001-route-optimization.md)
- [ADR-0002: Ranking Heuristics](docs/adr/0002-ranking-heuristics.md)
- [Judges Deployment Guide](docs/judges-deployment-guide.md)

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- [FastAPI](https://fastapi.tiangolo.com/)
- [Sentence Transformers](https://www.sbert.net/)
- [NetworkX TSP](https://networkx.org/documentation/stable/reference/algorithms/approximation.html#traveling-salesman)
- [gRPC](https://grpc.io/)
- [Kubernetes](https://kubernetes.io/)
- [Helm](https://helm.sh/)

---

**–ò—Ç–æ–≥–æ:** –ø–æ–ª–Ω–æ—Å—Ç—å—é production-ready –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è AI-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏, –≥–æ—Ç–æ–≤–∞—è –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ —Ä–∞–∑–≤–∏—Ç–∏—é.
